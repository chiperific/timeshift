<%= form_for [@user, @timesheet], { class: "form-inline"} do |t_form| %>
  <%= render 'shared/error_messages', object: t_form.object %>
  <div class="row form-group">
    <div class="col-xs-6">
      <div class="input-group">
        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
        <%= text_field_tag "week_num_to_date_field", @timesheet_date.strftime("%m/%d"), { class: "form-control readonly-disguiser", readonly: true } %>
      </div>
      <%= t_form.hidden_field :week_num, { value: @timesheet.week_num || @timesheet_date.cweek } %>
    </div>
    <div class="col-xs-6">
      <div class="input-group">
        <span class="input-group-addon"><i class="fa fa-calendar-o"></i></span>
        <%= t_form.number_field :year, { class: "form-control readonly-disguiser", value: @timesheet.year || @timesheet_date.strftime('%Y'), readonly: true } %>
      </div>
    </div>
  </div>

  <div class="row form-group">

    <fieldset class="col-xs-6 span-no-padding-both" id="hours_fieldset">
      <legend>Hours:</legend>

          <%= t_form.fields_for :timesheet_hours, @timesheet.timesheet_hours do |th_form| %>
            <%= th_form.hidden_field :timesheet_id %>
            <%= th_form.hidden_field :user_id, { value: @user.id } %>
            <%= th_form.hidden_field :weekday, { value: th_form.index+1 } %>
            <span class="col-xs-6">
              <span class="pull-right plus-r-padding">
                <%= TimesheetHour.day_name(th_form.index+1) %>
              </span>
            </span>

            <span class="col-xs-6">
              <%= th_form.number_field :hours, {class: "form-control", step: 'any' } %>
            </span>
          <% end %>

    </fieldset>
    
    <fieldset class="col-xs-6 span-no-padding-both" id="categories_fieldset">
      <legend>Categories:</legend>
      <% @timesheet_categories.each_with_index do |timesheet_category, index| %>
        <%= t_form.fields_for :timesheet_categories, timesheet_category do |tc_form| %>
          <%= tc_form.hidden_field :timesheet_id %>
          <%= tc_form.hidden_field :user_id, { value: @user.id } %>
          <%= tc_form.hidden_field :category_id %>
          <span class="col-xs-7">
            <span class="pull-right plus-r-padding wrapped-and-right">
              <%= timesheet_category.category.name %>
            </span>
          </span>
          <span class="col-xs-5">
            <%= tc_form.number_field :hours, { class: "form-control", step: 'any' } %>
          </span>
        <% end %>
      <% end %>
    </fieldset>
  
  </div>
  <div class="row buffered-row">
    <% if params[:auth] == "over" %>
      <%= link_to "Cancel", user_timesheets_path(current_user, auth: "over"), class: "btn btn-warning" %>
    <% else %>
      <%= link_to "Cancel", user_timesheets_path(@user), class: "btn btn-warning" %>
    <% end %>
    <%= t_form.submit "Submit", class: "btn btn-success pull-right" %>
  </div>

<% end %>